# 时光留声 - 语音功能使用指南

## 功能概述
时光留声应用提供完整的语音交互功能，让老年用户可以通过语音与AI进行自然对话，记录珍贵回忆。

## 语音功能特性
- 🎤 **语音识别**: 将用户说话转换为文字
- 🔊 **语音朗读**: AI问题自动朗读，适合老年人听力
- ✏️ **手动输入**: 语音不可用时的备选方案
- 🔄 **智能切换**: 自动检测并适应设备能力

## 使用方法

### 1. 启动应用
```bash
# 启动后端服务
cd memoir-backend && npm start

# 启动前端应用
npx expo start --go --clear
```

### 2. 扫描二维码
使用手机上的Expo Go应用扫描终端显示的二维码

### 3. 语音交互
1. **选择场景**: 选择"童年时光"、"求学之路"或"时代记忆"
2. **听取问题**: AI会自动朗读问题
3. **语音回答**: 点击"🎤 开始录音"按钮说话
4. **停止录音**: 点击"🔴 停止录音"或自动停止
5. **继续对话**: AI根据回答生成下一个问题

### 4. 控制选项
- **🔇 停止朗读**: 停止AI语音朗读
- **手动输入**: 切换到文字输入模式
- **返回**: 回到上级菜单

## 权限要求
- **麦克风权限**: 录音功能需要
- **网络连接**: AI服务需要
- **扬声器**: 语音朗读功能

## 故障排除

### 语音识别不工作
1. 检查麦克风权限是否已授予
2. 确保设备音量和麦克风正常
3. 使用"手动输入"作为备选方案

### 语音朗读没有声音
1. 检查设备音量设置
2. 点击"🔇 停止朗读"按钮重置
3. 确保应用有音频播放权限

### 网络连接问题
1. 确保设备连接到WiFi
2. 检查后端服务是否运行在 `192.168.3.115:3000`
3. 应用会自动降级到离线模式

## 技术细节

### 语音识别
- 引擎: `@react-native-voice/voice`
- 语言: 中文(zh-CN)
- 超时: 自动停止录音

### 语音合成
- 引擎: `expo-speech`
- 语言: 中文(zh-CN)
- 语速: 0.75x (适合老年人)

### 兼容性
- ✅ iOS 设备(iPhone/iPad)
- ✅ Android 设备
- ❌ Web浏览器(仅文字输入)

## 开发调试

### 查看日志
在Metro终端或手机上的Expo Go中查看调试信息:
```
Voice module loaded successfully
Voice availability check: true
Speech started
Recognized speech: [用户说话内容]
```

### 常见错误
- `Cannot read property 'startSpeech' of null`: 语音模块未正确初始化
- `permission denied`: 需要授予麦克风权限
- `Network request failed`: 后端服务连接问题

## 优化建议
1. 在安静环境中使用语音功能
2. 说话时保持正常语速和音量
3. 如遇问题可随时切换到手动输入
4. 定期重启应用以保持最佳性能 